package main

import (
	"encoding/json"
	"fmt"
	"reflect"
	"testing"

	"github.com/grafana/grafana_plugin_model/go/datasource"
)

func Test_convertProxyResponse(t *testing.T) {
	type args struct {
		jsonBytes []byte
	}
	tests := []struct {
		name    string
		args    args
		want    []*datasource.QueryResult
		wantErr bool
	}{
		{
			name: "a",
			args: args{
				[]byte("[{\"target\":\"t\",\"datapoints\":[[3.0262718932443704,1560505591000],[0.89875,1560505651000],[0.6952081696779261,1560505711000],[0.8545454545454545,1560505771000],[0.7333333333333333,1560505831000],[4.2101851851851855,1560505891000],[0.9583333333333335,1560505951000],[0.9493975903614458,1560506011000],[0.7337606837606838,1560506071000],[1.0156626506024096,1560506131000],[2.1231547870097005,1560506191000],[0.9454309224772629,1560506251000],[0.8013513513513514,1560506311000],[0.9835616438356164,1560506371000],[0.6963087248322146,1560506431000],[2.962307692307693,1560506491000],[0.8170415224913495,1560506551000],[0.8738237810094096,1560506611000],[0.881140350877193,1560506671000],[0.8644702358667167,1560506731000],[1.9510754955714886,1560506791000],[0.9461538461538461,1560506851000],[0.7274598600247015,1560506911000],[0.885605740818911,1560506971000],[0.7692574600971548,1560507031000],[3.843791136463361,1560507091000],[0.8041367665681722,1560507151000],[1.1782222222222223,1560507211000],[1.1115384615384616,1560507271000],[0.8384868421052633,1560507331000],[2.8578016910069177,1560507391000],[0.8354586589880708,1560507451000],[0.6979674796747968,1560507511000],[0.8887462558836114,1560507571000],[0.9611111111111111,1560507631000],[4.7935185185185185,1560507691000],[0.7202050405809484,1560507751000],[0.9237182159233015,1560507811000],[0.9038461538461539,1560507871000],[1.021969696969697,1560507931000],[3.4875579924082665,1560507991000],[0.8258542610127624,1560508051000],[0.8148312611012435,1560508111000],[1.125444839857651,1560508171000],[1.245796906523201,1560508231000],[4.8063223508459485,1560508291000],[0.6699244780097734,1560508351000],[0.974210760337928,1560508411000],[0.9482456140350877,1560508471000],[0.9434108527131784,1560508531000],[2.8995433789954337,1560508591000],[0.8367088607594936,1560508651000],[0.7979495941905169,1560508711000],[1.169853268119164,1560508771000],[0.7768939393939395,1560508831000],[3.7474110760918506,1560508891000],[0.6844805472424113,1560508951000],[1.1222627737226278,1560509011000],[0.8836612489307101,1560509071000],[0.7997138769670958,1560509131000],[2.7986633249791146,1560509191000],[0.8317474048442907,1560509251000],[0.955259026687598,1560509311000],[1.0216450216450217,1560509371000],[0.6113553113553114,1560509431000],[3.4921296296296296,1560509491000],[0.7710526315789474,1560509551000],[1.0194290245836637,1560509611000],[0.894781864841745,1560509671000],[0.894047619047619,1560509731000],[2.59125,1560509791000],[1.1048245614035088,1560509851000],[0.9617117117117115,1560509911000],[1.127927927927928,1560509971000],[0.6971830985915494,1560510031000],[5.205907534246575,1560510091000],[1.061306086183918,1560510151000],[1.1084845926551288,1560510211000],[0.8412280701754387,1560510271000],[0.8207098426637395,1560510331000],[3.3041060735671515,1560510391000],[1.0094057289439933,1560510451000],[0.7739350485027415,1560510511000],[0.8796015591165006,1560510571000],[0.6414893617021277,1560510631000],[5.333183250787934,1560510691000],[0.8125791473195442,1560510751000],[0.932,1560510811000],[0.8081196581196581,1560510871000],[0.8117182356813694,1560510931000],[3.2628747117601846,1560510991000],[0.9203539823008849,1560511051000],[0.7791785278568524,1560511111000],[0.7485404503753128,1560511171000],[0.7367816091954023,1560511231000],[4.1947271045328405,1560511291000],[0.8382601351351352,1560511351000],[0.9590717299578059,1560511411000],[0.8192982456140351,1560511471000],[0.8923783990808118,1560511531000],[2.4324675324675322,1560511591000],[0.902037617554859,1560511651000],[0.7737382378100941,1560511711000],[1.0094637223974763,1560511771000],[0.7096231493943472,1560511831000],[3.811832740213523,1560511891000],[0.8138605064415815,1560511951000],[0.9857714539795465,1560512011000],[0.7787028921998248,1560512071000],[0.9241849886277482,1560512131000],[2.584931506849315,1560512191000],[0.9101265822784811,1560512251000],[0.7965811965811965,1560512311000],[0.987111111111111,1560512371000],[0.9563218390804596,1560512431000],[5.018910400720396,1560512491000],[0.743611953226505,1560512551000],[0.9291666666666667,1560512611000],[0.9128205128205129,1560512671000],[0.9773391812865496,1560512731000],[3.610148514851485,1560512791000],[0.979077711357814,1560512851000],[0.9213973799126638,1560512911000],[1.2072604474461797,1560512971000],[1.1410741301059,1560513031000],[5.036028119507909,1560513091000],[0.7074561403508772,1560513151000],[1.0638041733547352,1560513211000],[1.038429054054054,1560513271000],[1.223015873015873,1560513331000],[3.6403246475865014,1560513391000],[1.079521162890124,1560513451000],[0.8603603603603603,1560513511000],[1.2382473756275674,1560513571000],[0.678246013667426,1560513631000],[5.123609394313967,1560513691000],[0.9744809688581315,1560513751000],[0.9183062446535499,1560513811000],[1.22797018851381,1560513871000],[0.8092592592592592,1560513931000],[3.057803468208092,1560513991000],[0.855473820856772,1560514051000],[0.7723342939481268,1560514111000],[1.0324561403508772,1560514171000],[0.6867765696246931,1560514231000],[3.7513513513513517,1560514291000],[0.9425918108906712,1560514351000],[1.055111111111111,1560514411000],[0.9355246523388117,1560514471000],[0.7785804020100502,1560514531000],[2.3988483685220725,1560514591000],[1.059437751004016,1560514651000],[0.9405622489959838,1560514711000],[0.9332755632582321,1560514771000],[0.7355555555555556,1560514831000],[3.43031440638198,1560514891000],[0.8623343309106456,1560514951000],[1.0016870518768453,1560515011000],[0.9539890249050231,1560515071000],[1.0716776443239056,1560515131000],[2.6253164556962028,1560515191000],[0.975298476739399,1560515251000],[0.8982222222222224,1560515311000],[1.2050228310502282,1560515371000],[0.8886271870794078,1560515431000],[4.323583180987203,1560515491000],[0.8827187916481564,1560515551000],[0.997776789684304,1560515611000],[0.8846491228070176,1560515671000],[0.9414728682170543,1560515731000],[3.4100456621004565,1560515791000],[1.0822784810126582,1560515851000],[1.0957264957264958,1560515911000],[0.9824482448244825,1560515971000],[0.8706928492034087,1560516031000],[4.890139576767223,1560516091000],[1.0021385799828912,1560516151000],[1.051827857473392,1560516211000],[0.9581017528858486,1560516271000],[1.0461208437611724,1560516331000],[3.1176231176231175,1560516391000],[1.0179007323026852,1560516451000],[0.8118300913060739,1560516511000],[0.9559640872167593,1560516571000],[1.019047619047619,1560516631000],[3.590515275877793,1560516691000],[0.7470127729707459,1560516751000],[0.9678972712680579,1560516811000],[1.1084845926551288,1560516871000],[0.9544919576304433,1560516931000],[2.173766343315057,1560516991000],[1.039844088349935,1560517051000],[1.0301801801801802,1560517111000],[1.0468468468468468,1560517171000],[0.6307099614749587,1560517231000],[3.5870774497218654,1560517291000],[0.7543859649122807,1560517351000],[0.9855263157894738,1560517411000],[0.9618882633174534,1560517471000],[1.1512542119056532,1560517531000],[2.605952909817858,1560517591000],[0.823603002502085,1560517651000],[0.8240506329113924,1560517711000],[0.9302841918294851,1560517771000],[1.1329824561403508,1560517831000],[5.220987105380169,1560517891000],[0.7361756015196285,1560517951000],[1.1434210526315791,1560518011000],[0.9602564102564102,1560518071000],[1.066494512588767,1560518131000],[3.5665474771553436,1560518191000],[0.8525512253917236,1560518251000],[0.7958519723464823,1560518311000],[0.9264892268694549,1560518371000],[0.9007951533510036,1560518431000],[5.0329035126722985,1560518491000],[1.0415584415584416,1560518551000],[0.9607594936708862,1560518611000],[1.067893123083662,1560518671000],[1.0037921880925293,1560518731000],[4.457264957264957,1560518791000],[0.8727121464226291,1560518851000],[0.9274092615769711,1560518911000],[1.0401081568273998,1560518971000],[0.8567621585609594,1560519031000],[4.821213524779991,1560519091000],[0.7301448003510311,1560519151000],[1.2595555555555555,1560519211000],[1.2938596491228072,1560519271000],[1.0906976744186045,1560519331000],[2.453881278538813,1560519391000],[0.8037037037037036,1560519451000],[1.1709216789268713,1560519511000],[0.9813333333333333,1560519571000],[0.9545282303902993,1560519631000],[3.595227375056281,1560519691000],[0.8973684210526316,1560519751000],[1.1901757548445244,1560519811000],[1.2276315789473684,1560519871000],[1.1613018597997138,1560519931000],[3.386644682605111,1560519991000],[1.1615384615384614,1560520051000],[1.0140675241157555,1560520111000],[0.996890270990671,1560520171000],[0.9170221015897634,1560520231000],[4.868656716417911,1560520291000],[1.2023474178403757,1560520351000],[1.5006490696668109,1560520411000],[1.0324470482199188,1560520471000],[1.1080168776371309,1560520531000],[4.054222222222222,1560520591000],[1.1258215962441316,1560520651000],[0.9729468599033817,1560520711000],[1.2019323671497586,1560520771000],[0.7665706051873198,1560520831000],[4.899405578417925,1560520891000],[1.0128510233222277,1560520951000],[1.0793150067598016,1560521011000],[1.3336506425511663,1560521071000],[1.0345098039215688,1560521131000],[3.917103382563125,1560521191000],[1.0923423423423422,1560521251000],[0.9207207207207206,1560521311000],[1.0433127082341742,1560521371000],[1.036643459142543,1560521431000],[6.458863858961803,1560521491000],[1.236888888888889,1560521551000],[1.0291936978683967,1560521611000],[0.9324200913242009,1560521671000],[0.8466278671687778,1560521731000],[4.220385674931131,1560521791000],[0.9240826655419654,1560521851000],[0.8627533783783783,1560521911000],[0.9868482855800845,1560521971000],[1.0066666666666666,1560522031000],[4.4233830845771145,1560522091000],[1.026376677464137,1560522151000],[0.8671701466015104,1560522211000],[0.9744058500914076,1560522271000],[1.0658436213991769,1560522331000],[2.789137380191693,1560522391000],[0.907225309961522,1560522451000],[0.9183574879227053,1560522511000],[1.317156862745098,1560522571000],[1.4436569808646351,1560522631000],[5.643277723258096,1560522691000],[0.8069444444444445,1560522751000],[1.0724287783679383,1560522811000],[0.9197836863452005,1560522871000],[1.1032921810699587,1560522931000],[3.685294117647058,1560522991000],[1.019616788321168,1560523051000],[1.0249110320284696,1560523111000],[1.1695652173913045,1560523171000],[1.0734939759036144,1560523231000],[6.1255432158377605,1560523291000],[1.1834182491894394,1560523351000],[1.0887254901960783,1560523411000],[1.3260352213231796,1560523471000],[0.9577570093457944,1560523531000],[3.7482206405693947,1560523591000],[1.0475978647686832,1560523651000],[0.9154250657318141,1560523711000],[1.1168717047451668,1560523771000],[0.939607843137255,1560523831000],[5.355047240179015,1560523891000],[0.9621451104100947,1560523951000],[0.985042735042735,1560524011000],[1.012785388127854,1560524071000],[0.9944491887275834,1560524131000],[3.7203687445127303,1560524191000],[1.0704225352112675,1560524251000],[1.0608695652173912,1560524311000],[1.2944634982851544,1560524371000],[1.0238484155504737,1560524431000],[4.120300751879699,1560524491000],[1.0266666666666668,1560524551000],[1.0027777777777775,1560524611000],[1.0826291079812207,1560524671000],[0.971462544589774,1560524731000],[2.4971804511278193,1560524791000],[0.8986029743127535,1560524851000],[1.0527027027027027,1560524911000],[1.1525096525096525,1560524971000],[0.9173768062245276,1560525031000],[3.95047619047619,1560525091000],[1.1658404686795854,1560525151000],[1.371904761904762,1560525211000],[1.0835616438356164,1560525271000],[0.8565128900949796,1560525331000],[2.0321661237785014,1560525391000],[1.268303375712407,1560525451000],[0.975298476739399,1560525511000],[1.0112815884476534,1560525571000],[0.931430836305985,1560525631000],[4.468318246784182,1560525691000],[0.9770063119927862,1560525751000],[1.0545045045045045,1560525811000],[1.2636022514071295,1560525871000],[1.0039714058776807,1560525931000],[3.885701064322073,1560525991000],[1.023076923076923,1560526051000],[1.2689814814814815,1560526111000],[1.3136781053649105,1560526171000],[0.767186392629341,1560526231000],[5.402845927379784,1560526291000],[1.1134169884169887,1560526351000],[1.1433270676691727,1560526411000],[1.193607305936073,1560526471000],[1.107730263157895,1560526531000],[3.9051477597712108,1560526591000],[1.143859649122807,1560526651000],[1.0433789954337898,1560526711000],[1.112689857912788,1560526771000],[1.0265767552558511,1560526831000],[4.818224518553311,1560526891000],[1.2348309402501159,1560526951000],[1.0288413724515166,1560527011000],[0.9597035664659563,1560527071000],[1.0839135214364235,1560527131000]],\"queries\":[{\"filter\":\"messagecontains\\\"error\\\"\",\"function\":\"count\",\"startTime\":\"1560505531\",\"endTime\":\"1560527131\",\"buckets\":360,\"priority\":\"low\"},{\"filter\":\"messagecontains\\\"success\\\"\",\"function\":\"count\",\"startTime\":\"1560505531\",\"endTime\":\"1560527131\",\"buckets\":360,\"priority\":\"low\"}],\"refId\":\"A\"}]"),
			},
			want: []*datasource.QueryResult{
				{
					RefId: "A",
					Series: []*datasource.TimeSeries{
						{
							Name:   "t",
							Points: convertArrToPoints(),
						},
					},
				},
			},
			wantErr: false,
		},
		{
			name: "double query",
			args: args{
				jsonBytes: []byte("[{\"target\":\"t\",\"datapoints\":[[3.8053435114503817,1561492043000],[2.0118895966029724,1561492103000],[1.6390176088971269,1561492163000],[1.3170620437956204,1561492223000],[1.4090029041626329,1561492283000],[4.559611829944547,1561492343000],[2.815657715065999,1561492403000],[1.3955393718707327,1561492463000],[1.1595119746949842,1561492523000],[1.4109716410971642,1561492583000],[4.049888641425389,1561492643000],[2.362439024390244,1561492703000],[1.5711662075298436,1561492763000],[0.9704537460429125,1561492823000],[1.6346408109299249,1561492883000],[3.178237921234267,1561492943000],[2.5902939804013068,1561493003000],[1.5239449976292079,1561493063000],[1.857266811279826,1561493123000],[1.4096876414667272,1561493183000],[4.132684652808492,1561493243000],[2.171325518485122,1561493303000],[1.537201684604586,1561493363000],[1.332522303325223,1561493423000],[1.898074213245655,1561493483000],[4.050975177304965,1561493543000],[2.8105769230769226,1561493603000],[1.3910588235294115,1561493663000],[1.2705259175179722,1561493723000],[1.2158756824863501,1561493783000],[3.2966037735849056,1561493843000],[1.687830687830688,1561513043000],[1.759768451519537,1561513103000],[1.8954937679769897,1561513163000],[4.315882874889086,1561513223000],[2.6627469426152395,1561513283000],[1.7570596145226354,1561513343000],[2.0114122681883027,1561513403000],[1.8752345215759854,1561513463000],[3.476145038167939,1561513523000],[2.0405582206716093,1561513583000]],\"queries\":[{\"filter\":\"message contains \\\"error\\\"\",\"function\":\"count\",\"startTime\":\"1561491983\",\"endTime\":\"1561513583\",\"buckets\":360,\"priority\":\"low\"},{\"filter\":\"message contains \\\"success\\\"\",\"function\":\"count\",\"startTime\":\"1561491983\",\"endTime\":\"1561513583\",\"buckets\":360,\"priority\":\"low\"}],\"refId\":\"A\"},{\"target\":\"T3 % Errors\",\"datapoints\":[[39.35565382185723,1561494383000],[28.158923143725577,1561496783000],[0,1561499183000],[18.27005423922352,1561501583000],[29.830021546564517,1561503983000],[242.52120277563606,1561506383000],[12.90271636133923,1561508783000],[74.01696222050886,1561511183000],[0,1561513583000]],\"queries\":[{\"filter\":\"$serverHost = 'testEnvT3' and $logfile = '\\/var\\/log\\/nginx\\/error.log'\",\"function\":\"count\",\"startTime\":\"1561491983\",\"endTime\":\"1561513583\",\"buckets\":9,\"priority\":\"low\"},{\"filter\":\"$serverHost = 'testEnvT3' and $logfile = '\\/var\\/log\\/nginx\\/access.log' and $uriPath != \\\"\\/jspvlen.php\\\" and $uriPath != \\\"\\/healthcheck.php\\\" and $status = 200\",\"function\":\"count\",\"startTime\":\"1561491983\",\"endTime\":\"1561513583\",\"buckets\":9,\"priority\":\"low\"}, \"100\"],\"refId\":\"B\"}]"),
			},
			want: []*datasource.QueryResult{
				{
					RefId: "A",
					Series: []*datasource.TimeSeries{
						{
							Name: "t",
							Points: []*datasource.Point{
								&datasource.Point{Value: 3.805344, Timestamp: 1561492043000},
								&datasource.Point{Value: 2.011890, Timestamp: 1561492103000},
								&datasource.Point{Value: 1.639018, Timestamp: 1561492163000},
								&datasource.Point{Value: 1.317062, Timestamp: 1561492223000},
								&datasource.Point{Value: 1.409003, Timestamp: 1561492283000},
								&datasource.Point{Value: 4.559612, Timestamp: 1561492343000},
								&datasource.Point{Value: 2.815658, Timestamp: 1561492403000},
								&datasource.Point{Value: 1.395539, Timestamp: 1561492463000},
								&datasource.Point{Value: 1.159512, Timestamp: 1561492523000},
								&datasource.Point{Value: 1.410972, Timestamp: 1561492583000},
								&datasource.Point{Value: 4.049889, Timestamp: 1561492643000},
								&datasource.Point{Value: 2.362439, Timestamp: 1561492703000},
								&datasource.Point{Value: 1.571166, Timestamp: 1561492763000},
								&datasource.Point{Value: 0.970454, Timestamp: 1561492823000},
								&datasource.Point{Value: 1.634641, Timestamp: 1561492883000},
								&datasource.Point{Value: 3.178238, Timestamp: 1561492943000},
								&datasource.Point{Value: 2.590294, Timestamp: 1561493003000},
								&datasource.Point{Value: 1.523945, Timestamp: 1561493063000},
								&datasource.Point{Value: 1.857267, Timestamp: 1561493123000},
								&datasource.Point{Value: 1.409688, Timestamp: 1561493183000},
								&datasource.Point{Value: 4.132685, Timestamp: 1561493243000},
								&datasource.Point{Value: 2.171326, Timestamp: 1561493303000},
								&datasource.Point{Value: 1.537202, Timestamp: 1561493363000},
								&datasource.Point{Value: 1.332522, Timestamp: 1561493423000},
								&datasource.Point{Value: 1.898074, Timestamp: 1561493483000},
								&datasource.Point{Value: 4.050975, Timestamp: 1561493543000},
								&datasource.Point{Value: 2.810577, Timestamp: 1561493603000},
								&datasource.Point{Value: 1.391059, Timestamp: 1561493663000},
								&datasource.Point{Value: 1.270526, Timestamp: 1561493723000},
								&datasource.Point{Value: 1.215876, Timestamp: 1561493783000},
								&datasource.Point{Value: 3.296604, Timestamp: 1561493843000},
								&datasource.Point{Value: 1.687831, Timestamp: 1561513043000},
								&datasource.Point{Value: 1.759768, Timestamp: 1561513103000},
								&datasource.Point{Value: 1.895494, Timestamp: 1561513163000},
								&datasource.Point{Value: 4.315883, Timestamp: 1561513223000},
								&datasource.Point{Value: 2.662747, Timestamp: 1561513283000},
								&datasource.Point{Value: 1.757060, Timestamp: 1561513343000},
								&datasource.Point{Value: 2.011412, Timestamp: 1561513403000},
								&datasource.Point{Value: 1.875235, Timestamp: 1561513463000},
								&datasource.Point{Value: 3.476145, Timestamp: 1561513523000},
								&datasource.Point{Value: 2.040558, Timestamp: 1561513583000},
							},
						},
					},
				},
				{
					RefId: "B",
					Series: []*datasource.TimeSeries{
						{
							Name: "T3 % Errors",
							Points: []*datasource.Point{
								&datasource.Point{Value: 39.355654, Timestamp: 1561494383000},
								&datasource.Point{Value: 28.158923, Timestamp: 1561496783000},
								&datasource.Point{Value: 0.000000, Timestamp: 1561499183000},
								&datasource.Point{Value: 18.270054, Timestamp: 1561501583000},
								&datasource.Point{Value: 29.830022, Timestamp: 1561503983000},
								&datasource.Point{Value: 242.521203, Timestamp: 1561506383000},
								&datasource.Point{Value: 12.902716, Timestamp: 1561508783000},
								&datasource.Point{Value: 74.016962, Timestamp: 1561511183000},
								&datasource.Point{Value: 0.000000, Timestamp: 1561513583000},
							},
						},
					},
				},
			},
			wantErr: false,
		},
	}

	var bodyToSend []map[string]interface{}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			err := json.Unmarshal(tt.args.jsonBytes, &bodyToSend)
			fmt.Print(bodyToSend[0])
			if err != nil {
				t.Errorf("Really can't jsonDecode thta shit")
			}
			//got, err := convertProxyResponse(tt.args.jsonBytes)
			//if (err != nil) != tt.wantErr {
			//	t.Errorf("convertProxyResponse() error = %v, wantErr %v", err, tt.wantErr)
			//	return
			//}
			//if !reflect.DeepEqual(got, tt.want) {
			//	t.Errorf("convertProxyResponse() = %v, want %v", got, tt.want)
			//}
		})
	}
}

func convertArrToPoints() []*datasource.Point {
	arr := [][]float64{
		{3.0262718932443704, 1560505591000},
		{0.89875, 1560505651000},
		{0.6952081696779261, 1560505711000},
		{0.8545454545454545, 1560505771000},
		{0.7333333333333333, 1560505831000},
		{4.2101851851851855, 1560505891000},
		{0.9583333333333335, 1560505951000},
		{0.9493975903614458, 1560506011000},
		{0.7337606837606838, 1560506071000},
		{1.0156626506024096, 1560506131000},
		{2.1231547870097005, 1560506191000},
		{0.9454309224772629, 1560506251000},
		{0.8013513513513514, 1560506311000},
		{0.9835616438356164, 1560506371000},
		{0.6963087248322146, 1560506431000},
		{2.962307692307693, 1560506491000},
		{0.8170415224913495, 1560506551000},
		{0.8738237810094096, 1560506611000},
		{0.881140350877193, 1560506671000},
		{0.8644702358667167, 1560506731000},
		{1.9510754955714886, 1560506791000},
		{0.9461538461538461, 1560506851000},
		{0.7274598600247015, 1560506911000},
		{0.885605740818911, 1560506971000},
		{0.7692574600971548, 1560507031000},
		{3.843791136463361, 1560507091000},
		{0.8041367665681722, 1560507151000},
		{1.1782222222222223, 1560507211000},
		{1.1115384615384616, 1560507271000},
		{0.8384868421052633, 1560507331000},
		{2.8578016910069177, 1560507391000},
		{0.8354586589880708, 1560507451000},
		{0.6979674796747968, 1560507511000},
		{0.8887462558836114, 1560507571000},
		{0.9611111111111111, 1560507631000},
		{4.7935185185185185, 1560507691000},
		{0.7202050405809484, 1560507751000},
		{0.9237182159233015, 1560507811000},
		{0.9038461538461539, 1560507871000},
		{1.021969696969697, 1560507931000},
		{3.4875579924082665, 1560507991000},
		{0.8258542610127624, 1560508051000},
		{0.8148312611012435, 1560508111000},
		{1.125444839857651, 1560508171000},
		{1.245796906523201, 1560508231000},
		{4.8063223508459485, 1560508291000},
		{0.6699244780097734, 1560508351000},
		{0.974210760337928, 1560508411000},
		{0.9482456140350877, 1560508471000},
		{0.9434108527131784, 1560508531000},
		{2.8995433789954337, 1560508591000},
		{0.8367088607594936, 1560508651000},
		{0.7979495941905169, 1560508711000},
		{1.169853268119164, 1560508771000},
		{0.7768939393939395, 1560508831000},
		{3.7474110760918506, 1560508891000},
		{0.6844805472424113, 1560508951000},
		{1.1222627737226278, 1560509011000},
		{0.8836612489307101, 1560509071000},
		{0.7997138769670958, 1560509131000},
		{2.7986633249791146, 1560509191000},
		{0.8317474048442907, 1560509251000},
		{0.955259026687598, 1560509311000},
		{1.0216450216450217, 1560509371000},
		{0.6113553113553114, 1560509431000},
		{3.4921296296296296, 1560509491000},
		{0.7710526315789474, 1560509551000},
		{1.0194290245836637, 1560509611000},
		{0.894781864841745, 1560509671000},
		{0.894047619047619, 1560509731000},
		{2.59125, 1560509791000},
		{1.1048245614035088, 1560509851000},
		{0.9617117117117115, 1560509911000},
		{1.127927927927928, 1560509971000},
		{0.6971830985915494, 1560510031000},
		{5.205907534246575, 1560510091000},
		{1.061306086183918, 1560510151000},
		{1.1084845926551288, 1560510211000},
		{0.8412280701754387, 1560510271000},
		{0.8207098426637395, 1560510331000},
		{3.3041060735671515, 1560510391000},
		{1.0094057289439933, 1560510451000},
		{0.7739350485027415, 1560510511000},
		{0.8796015591165006, 1560510571000},
		{0.6414893617021277, 1560510631000},
		{5.333183250787934, 1560510691000},
		{0.8125791473195442, 1560510751000},
		{0.932, 1560510811000},
		{0.8081196581196581, 1560510871000},
		{0.8117182356813694, 1560510931000},
		{3.2628747117601846, 1560510991000},
		{0.9203539823008849, 1560511051000},
		{0.7791785278568524, 1560511111000},
		{0.7485404503753128, 1560511171000},
		{0.7367816091954023, 1560511231000},
		{4.1947271045328405, 1560511291000},
		{0.8382601351351352, 1560511351000},
		{0.9590717299578059, 1560511411000},
		{0.8192982456140351, 1560511471000},
		{0.8923783990808118, 1560511531000},
		{2.4324675324675322, 1560511591000},
		{0.902037617554859, 1560511651000},
		{0.7737382378100941, 1560511711000},
		{1.0094637223974763, 1560511771000},
		{0.7096231493943472, 1560511831000},
		{3.811832740213523, 1560511891000},
		{0.8138605064415815, 1560511951000},
		{0.9857714539795465, 1560512011000},
		{0.7787028921998248, 1560512071000},
		{0.9241849886277482, 1560512131000},
		{2.584931506849315, 1560512191000},
		{0.9101265822784811, 1560512251000},
		{0.7965811965811965, 1560512311000},
		{0.987111111111111, 1560512371000},
		{0.9563218390804596, 1560512431000},
		{5.018910400720396, 1560512491000},
		{0.743611953226505, 1560512551000},
		{0.9291666666666667, 1560512611000},
		{0.9128205128205129, 1560512671000},
		{0.9773391812865496, 1560512731000},
		{3.610148514851485, 1560512791000},
		{0.979077711357814, 1560512851000},
		{0.9213973799126638, 1560512911000},
		{1.2072604474461797, 1560512971000},
		{1.1410741301059, 1560513031000},
		{5.036028119507909, 1560513091000},
		{0.7074561403508772, 1560513151000},
		{1.0638041733547352, 1560513211000},
		{1.038429054054054, 1560513271000},
		{1.223015873015873, 1560513331000},
		{3.6403246475865014, 1560513391000},
		{1.079521162890124, 1560513451000},
		{0.8603603603603603, 1560513511000},
		{1.2382473756275674, 1560513571000},
		{0.678246013667426, 1560513631000},
		{5.123609394313967, 1560513691000},
		{0.9744809688581315, 1560513751000},
		{0.9183062446535499, 1560513811000},
		{1.22797018851381, 1560513871000},
		{0.8092592592592592, 1560513931000},
		{3.057803468208092, 1560513991000},
		{0.855473820856772, 1560514051000},
		{0.7723342939481268, 1560514111000},
		{1.0324561403508772, 1560514171000},
		{0.6867765696246931, 1560514231000},
		{3.7513513513513517, 1560514291000},
		{0.9425918108906712, 1560514351000},
		{1.055111111111111, 1560514411000},
		{0.9355246523388117, 1560514471000},
		{0.7785804020100502, 1560514531000},
		{2.3988483685220725, 1560514591000},
		{1.059437751004016, 1560514651000},
		{0.9405622489959838, 1560514711000},
		{0.9332755632582321, 1560514771000},
		{0.7355555555555556, 1560514831000},
		{3.43031440638198, 1560514891000},
		{0.8623343309106456, 1560514951000},
		{1.0016870518768453, 1560515011000},
		{0.9539890249050231, 1560515071000},
		{1.0716776443239056, 1560515131000},
		{2.6253164556962028, 1560515191000},
		{0.975298476739399, 1560515251000},
		{0.8982222222222224, 1560515311000},
		{1.2050228310502282, 1560515371000},
		{0.8886271870794078, 1560515431000},
		{4.323583180987203, 1560515491000},
		{0.8827187916481564, 1560515551000},
		{0.997776789684304, 1560515611000},
		{0.8846491228070176, 1560515671000},
		{0.9414728682170543, 1560515731000},
		{3.4100456621004565, 1560515791000},
		{1.0822784810126582, 1560515851000},
		{1.0957264957264958, 1560515911000},
		{0.9824482448244825, 1560515971000},
		{0.8706928492034087, 1560516031000},
		{4.890139576767223, 1560516091000},
		{1.0021385799828912, 1560516151000},
		{1.051827857473392, 1560516211000},
		{0.9581017528858486, 1560516271000},
		{1.0461208437611724, 1560516331000},
		{3.1176231176231175, 1560516391000},
		{1.0179007323026852, 1560516451000},
		{0.8118300913060739, 1560516511000},
		{0.9559640872167593, 1560516571000},
		{1.019047619047619, 1560516631000},
		{3.590515275877793, 1560516691000},
		{0.7470127729707459, 1560516751000},
		{0.9678972712680579, 1560516811000},
		{1.1084845926551288, 1560516871000},
		{0.9544919576304433, 1560516931000},
		{2.173766343315057, 1560516991000},
		{1.039844088349935, 1560517051000},
		{1.0301801801801802, 1560517111000},
		{1.0468468468468468, 1560517171000},
		{0.6307099614749587, 1560517231000},
		{3.5870774497218654, 1560517291000},
		{0.7543859649122807, 1560517351000},
		{0.9855263157894738, 1560517411000},
		{0.9618882633174534, 1560517471000},
		{1.1512542119056532, 1560517531000},
		{2.605952909817858, 1560517591000},
		{0.823603002502085, 1560517651000},
		{0.8240506329113924, 1560517711000},
		{0.9302841918294851, 1560517771000},
		{1.1329824561403508, 1560517831000},
		{5.220987105380169, 1560517891000},
		{0.7361756015196285, 1560517951000},
		{1.1434210526315791, 1560518011000},
		{0.9602564102564102, 1560518071000},
		{1.066494512588767, 1560518131000},
		{3.5665474771553436, 1560518191000},
		{0.8525512253917236, 1560518251000},
		{0.7958519723464823, 1560518311000},
		{0.9264892268694549, 1560518371000},
		{0.9007951533510036, 1560518431000},
		{5.0329035126722985, 1560518491000},
		{1.0415584415584416, 1560518551000},
		{0.9607594936708862, 1560518611000},
		{1.067893123083662, 1560518671000},
		{1.0037921880925293, 1560518731000},
		{4.457264957264957, 1560518791000},
		{0.8727121464226291, 1560518851000},
		{0.9274092615769711, 1560518911000},
		{1.0401081568273998, 1560518971000},
		{0.8567621585609594, 1560519031000},
		{4.821213524779991, 1560519091000},
		{0.7301448003510311, 1560519151000},
		{1.2595555555555555, 1560519211000},
		{1.2938596491228072, 1560519271000},
		{1.0906976744186045, 1560519331000},
		{2.453881278538813, 1560519391000},
		{0.8037037037037036, 1560519451000},
		{1.1709216789268713, 1560519511000},
		{0.9813333333333333, 1560519571000},
		{0.9545282303902993, 1560519631000},
		{3.595227375056281, 1560519691000},
		{0.8973684210526316, 1560519751000},
		{1.1901757548445244, 1560519811000},
		{1.2276315789473684, 1560519871000},
		{1.1613018597997138, 1560519931000},
		{3.386644682605111, 1560519991000},
		{1.1615384615384614, 1560520051000},
		{1.0140675241157555, 1560520111000},
		{0.996890270990671, 1560520171000},
		{0.9170221015897634, 1560520231000},
		{4.868656716417911, 1560520291000},
		{1.2023474178403757, 1560520351000},
		{1.5006490696668109, 1560520411000},
		{1.0324470482199188, 1560520471000},
		{1.1080168776371309, 1560520531000},
		{4.054222222222222, 1560520591000},
		{1.1258215962441316, 1560520651000},
		{0.9729468599033817, 1560520711000},
		{1.2019323671497586, 1560520771000},
		{0.7665706051873198, 1560520831000},
		{4.899405578417925, 1560520891000},
		{1.0128510233222277, 1560520951000},
		{1.0793150067598016, 1560521011000},
		{1.3336506425511663, 1560521071000},
		{1.0345098039215688, 1560521131000},
		{3.917103382563125, 1560521191000},
		{1.0923423423423422, 1560521251000},
		{0.9207207207207206, 1560521311000},
		{1.0433127082341742, 1560521371000},
		{1.036643459142543, 1560521431000},
		{6.458863858961803, 1560521491000},
		{1.236888888888889, 1560521551000},
		{1.0291936978683967, 1560521611000},
		{0.9324200913242009, 1560521671000},
		{0.8466278671687778, 1560521731000},
		{4.220385674931131, 1560521791000},
		{0.9240826655419654, 1560521851000},
		{0.8627533783783783, 1560521911000},
		{0.9868482855800845, 1560521971000},
		{1.0066666666666666, 1560522031000},
		{4.4233830845771145, 1560522091000},
		{1.026376677464137, 1560522151000},
		{0.8671701466015104, 1560522211000},
		{0.9744058500914076, 1560522271000},
		{1.0658436213991769, 1560522331000},
		{2.789137380191693, 1560522391000},
		{0.907225309961522, 1560522451000},
		{0.9183574879227053, 1560522511000},
		{1.317156862745098, 1560522571000},
		{1.4436569808646351, 1560522631000},
		{5.643277723258096, 1560522691000},
		{0.8069444444444445, 1560522751000},
		{1.0724287783679383, 1560522811000},
		{0.9197836863452005, 1560522871000},
		{1.1032921810699587, 1560522931000},
		{3.685294117647058, 1560522991000},
		{1.019616788321168, 1560523051000},
		{1.0249110320284696, 1560523111000},
		{1.1695652173913045, 1560523171000},
		{1.0734939759036144, 1560523231000},
		{6.1255432158377605, 1560523291000},
		{1.1834182491894394, 1560523351000},
		{1.0887254901960783, 1560523411000},
		{1.3260352213231796, 1560523471000},
		{0.9577570093457944, 1560523531000},
		{3.7482206405693947, 1560523591000},
		{1.0475978647686832, 1560523651000},
		{0.9154250657318141, 1560523711000},
		{1.1168717047451668, 1560523771000},
		{0.939607843137255, 1560523831000},
		{5.355047240179015, 1560523891000},
		{0.9621451104100947, 1560523951000},
		{0.985042735042735, 1560524011000},
		{1.012785388127854, 1560524071000},
		{0.9944491887275834, 1560524131000},
		{3.7203687445127303, 1560524191000},
		{1.0704225352112675, 1560524251000},
		{1.0608695652173912, 1560524311000},
		{1.2944634982851544, 1560524371000},
		{1.0238484155504737, 1560524431000},
		{4.120300751879699, 1560524491000},
		{1.0266666666666668, 1560524551000},
		{1.0027777777777775, 1560524611000},
		{1.0826291079812207, 1560524671000},
		{0.971462544589774, 1560524731000},
		{2.4971804511278193, 1560524791000},
		{0.8986029743127535, 1560524851000},
		{1.0527027027027027, 1560524911000},
		{1.1525096525096525, 1560524971000},
		{0.9173768062245276, 1560525031000},
		{3.95047619047619, 1560525091000},
		{1.1658404686795854, 1560525151000},
		{1.371904761904762, 1560525211000},
		{1.0835616438356164, 1560525271000},
		{0.8565128900949796, 1560525331000},
		{2.0321661237785014, 1560525391000},
		{1.268303375712407, 1560525451000},
		{0.975298476739399, 1560525511000},
		{1.0112815884476534, 1560525571000},
		{0.931430836305985, 1560525631000},
		{4.468318246784182, 1560525691000},
		{0.9770063119927862, 1560525751000},
		{1.0545045045045045, 1560525811000},
		{1.2636022514071295, 1560525871000},
		{1.0039714058776807, 1560525931000},
		{3.885701064322073, 1560525991000},
		{1.023076923076923, 1560526051000},
		{1.2689814814814815, 1560526111000},
		{1.3136781053649105, 1560526171000},
		{0.767186392629341, 1560526231000},
		{5.402845927379784, 1560526291000},
		{1.1134169884169887, 1560526351000},
		{1.1433270676691727, 1560526411000},
		{1.193607305936073, 1560526471000},
		{1.107730263157895, 1560526531000},
		{3.9051477597712108, 1560526591000},
		{1.143859649122807, 1560526651000},
		{1.0433789954337898, 1560526711000},
		{1.112689857912788, 1560526771000},
		{1.0265767552558511, 1560526831000},
		{4.818224518553311, 1560526891000},
		{1.2348309402501159, 1560526951000},
		{1.0288413724515166, 1560527011000},
		{0.9597035664659563, 1560527071000},
		{1.0839135214364235, 1560527131000},
	}
	pointArr := make([]*datasource.Point, 0)

	for _, point := range arr {
		pointStruct := datasource.Point{
			Timestamp: int64(point[1]),
			Value:     point[0],
		}

		pointArr = append(pointArr, &pointStruct)
	}

	return pointArr
}

func Test_handleAlertRequest(t *testing.T) {
	type args struct {
		tsdbReq     *datasource.DatasourceRequest
		jsonRequest map[string]interface{}
	}

	tests := []struct {
		name    string
		args    args
		want    []byte
		wantErr bool
	}{
		{
			name: "Test 1",
			args: args{
				tsdbReq: &datasource.DatasourceRequest{
					TimeRange: &datasource.TimeRange{
						FromEpochMs: 100,
						ToEpochMs:   200,
					},
				},
				jsonRequest: map[string]interface{}{
					"hello": "world",
				},
			},
			want:    []byte("{\"range\":{\"from\":100,\"to\":200},\"targets\":[{\"hello\":\"world\"}]}"),
			wantErr: false,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			got, err := handleAlertRequest(tt.args.tsdbReq, tt.args.jsonRequest)
			if (err != nil) != tt.wantErr {
				t.Errorf("handleAlertRequest() error = %v, wantErr %v", err, tt.wantErr)
				return
			}
			if !reflect.DeepEqual(got, tt.want) {
				t.Errorf("handleAlertRequest() = %v, want %v", string(got), string(tt.want))
			}
		})
	}
}
